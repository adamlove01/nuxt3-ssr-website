import{_ as I}from"./nuxt-link.QuyBbs83.js";import{_ as N,q as T,Z as U,$ as A,u as E,v as F,x as i,A as m,c as x,w as n,h as P,s as e,V as j,o as k,a as o,l as H,m as g,t as f,B as L,M as R,L as M,H as $,C,g as S,f as O,j as D,E as W,W as Z,N as G,P as J,O as q}from"./entry.Bqw1Ow-d.js";import{u as K}from"./vue.f36acd1f.Dlr9V4YO.js";import"./paginateSchema.CNhM6YFK.js";import{a as Q}from"./apiFetch.RR_u0FcO.js";const X={class:"forgot mt-4 mb-0 text-center text-body-1"},Y={class:"mt-8 text-center"},ee={__name:"login",emits:["banner"],setup(te,{emit:ae}){K({title:T("signIn")});const _=U(),u=A(),V=E(),v=F(),z=i(null),d=i(!1),c=i(!1),a=i(null),w=i(!1),r=i({email:"",password:""}),b={};for(const t in r.value)b[t]=[()=>G(t,r.value[t],q)];u.query.m==="registered"&&(a.value={status:"success",title:m("registered")}),u.query.m==="unauthorized"&&(a.value={status:"info",title:m("unauthorized")}),u.query.m==="loginError"&&(a.value={status:"info",title:m("loginError")});async function B(){d.value=!0,a.value=null;const[t,s]=await J(r.value,q);if(t)return d.value=!1;const{status:p,code:l,field:y,details:h}=await Q("/api/login",{method:"POST",body:r.value});if(d.value=!1,["email","password"].includes(y))return w.value=!0,a.value={status:"error",title:m(l,y)};if(V.setBanner({type:p,title:m(l,y)}),p==="success")return v.setToken(h.token),v.setUser(h.user),v.setLoggedIn(!0),u.query.to?_.push({path:u.query.to}):_.push({path:"/"})}return(t,s)=>{const p=I;return k(),x(j,{class:"bg_white_geometric pt-12",fluid:"",style:P(`background-image: url(/img/bg_geometric_${e(V).theme}.jpg); background-size: cover`)},{default:n(()=>[o(D,{class:"mx-auto mt-6 pa-3 rounded-lg",elevation:"8","max-width":"400"},{default:n(()=>[o(H,{class:"text-h4 justify-center mb-6"},{default:n(()=>[g(f(t.$t("login.signIn")),1)]),_:1}),o(L,null,{default:n(()=>[o(R,{ref_key:"form",ref:z,"validate-on":"blur lazy",onSubmit:M(B,["prevent"])},{default:n(()=>[o($,{modelValue:e(r).email,"onUpdate:modelValue":s[0]||(s[0]=l=>e(r).email=l),variant:"outlined",density:"comfortable",class:"mb-3",label:t.$t("fields.email"),rules:b.email},null,8,["modelValue","label","rules"]),o($,{modelValue:e(r).password,"onUpdate:modelValue":s[1]||(s[1]=l=>e(r).password=l),variant:"outlined",density:"comfortable",label:t.$t("fields.password"),autocomplete:"",rules:b.password,"append-inner-icon":e(c)?"mdi-eye-outline":"mdi-eye-off-outline",type:e(c)?"text":"password",hint:"At least 8 characters","onClick:appendInner":s[2]||(s[2]=l=>c.value=!e(c))},null,8,["modelValue","label","rules","append-inner-icon","type"]),o(C,{disabled:e(d),loading:e(d),type:"submit",class:"mt-6",rounded:"xl",size:"x-large",block:"",color:"blue darken-2"},{default:n(()=>[g(f(t.$t("all.buttons.signIn")),1)]),_:1},8,["disabled","loading"])]),_:1},512),e(w)?(k(),x(p,{key:0,to:"/forgot-password"},{default:n(()=>[S("div",X,f(t.$t("login.forgotPassword")),1)]),_:1})):O("",!0)]),_:1})]),_:1}),o(Z,{modelValue:e(a),"onUpdate:modelValue":s[3]||(s[3]=l=>W(a)?a.value=l:null),variant:"elevated",elevation:"8",class:"mx-auto mt-4","max-width":"400",closable:"",prominent:"",type:e(a)&&e(a).status,title:e(a)&&e(a).title},null,8,["modelValue","type","title"]),S("div",Y,[g(f(t.$t("login.noAccount"))+" ",1),o(C,{class:"ml-2",variant:"outlined",rounded:"xl",color:"blue darken-2",to:"/register"},{default:n(()=>[g(f(t.$t("all.buttons.signUpNow")),1)]),_:1})])]),_:1},8,["style"])}}},ie=N(ee,[["__scopeId","data-v-20fb5c7f"]]);export{ie as default};
